(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"../blocks/sentiment/sentiment.js":function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"init",(function(){return n}));var i=s("../../node_modules/highcharts/highcharts.js"),a=s.n(i);function n(){e.fn.highlight=function(t,s,i,a){var n=new RegExp(t,"i");return this.each((function(){e(this).contents().filter((function(){return 3==this.nodeType&&n.test(this.nodeValue)})).replaceWith((function(){return(this.nodeValue||"").replace(n,(function(e){return'<span class="'+i+'" data-series="'+s+'"><span class="'+a+'"></span>'+e+"</span>"}))}))}))};var t=e(window),s=e(document),i=e(".js-sentiment-load"),n=e(".js-sentiment-tool"),r=e(".js-sentiment-title"),l=e(".js-sentiment-indicator"),o=e(".js-sentiment-bg"),d=e(".js-sentiment-bg-success"),c=e(".js-sentiment-bg-danger"),h=e(".js-sentiment-list"),m=e(".js-sentiment-scroll"),v=e(".is-success.js-sentiment-scroll"),g=e(".is-danger.js-sentiment-scroll"),p=".js-sentiment-item",u=e(".js-pagination-sentiment"),w=e(".sentiment-review-page"),f=e(".sentiment-detail-page"),b=e(".js-sentiment-meta"),j=e(".js-review-list"),T=e(".js-review-text"),x=(e(".js-review-expand"),".js-review-highlight"),k=e(".js-review-slideNav"),C=e(".js-review-slideFor");n.clone().appendTo(".sentiment-graph-body"),n=e(".js-sentiment-tool");var y=e(".sentiment-graph").data("settings");y=e.extend({},{drilldown:[],series:[],ajaxPath:"",bookmakerId:0,tagId:0,slider:!1,count:10,paginationTemplate:"",logo:[]},y);var L=a.a.chart("js-sentiment",{chart:{type:"bubble",plotBorderWidth:1,plotBorderColor:"#e2e2e2",style:{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif","z-index":"1"},zoomType:"",margin:[1,1,null,1],events:{render:function(){setTimeout((function(){var t=e(".highcharts-plot-background").height();l.height(t+2),o.height(t+2)}),500);var t=Math.abs(this.yAxis[0].min),s=Math.abs(this.yAxis[0].max);this.yAxis[0].min>0&&this.yAxis[0].max>0?t=0:this.yAxis[0].min<0&&this.yAxis[0].max<0&&(s=0);var i=t+s,a=100*t/i,n=100*s/i;a<n||a>n?(l.css({background:"linear-gradient(to top, #d0021b "+a+"%, #20a94a "+a+"%)"}),d.css("height",n+"%"),c.css("height",a+"%")):(l.css({background:"linear-gradient(to top, #d0021b 50%, #20a94a 50%)"}),d.css("height",n+"%"),c.css("height",a+"%"))},drilldown:function(){setTimeout((function(){var t=L.series[0].chart.drilldownLevels[0].pointOptions.y,s=L.drilldownLevels[0].pointOptions.name;if(L.update({chart:{zoomType:""}}),n.css("display","flex"),t>=0?r.addClass("is-success"):r.addClass("is-danger"),r.html("Упоминания под тегом "+s),m.html(""),y.tagId=L.drilldownLevels[0].pointOptions.id,E(),e(L.series[0].data).each((function(t,s){var i=e.parseHTML('<button class="sentiment-graph-item sentiment-sub-tag js-sentiment-item" data-series="'+t+'" data-id="'+s.dataId+'">'+s.name+" <span>("+s.z+")</span></button>");e(".js-review-gap").unwrap().remove(),setTimeout((function(){T.highlight(s.name,t,"is-highlight js-review-highlight "+s.class,"js-review-gap"),s.y>=0?(e(i).appendTo(v),e(x+'[data-series="'+t+'"]').addClass("is-success")):(e(i).appendTo(g),e(x+'[data-series="'+t+'"]').addClass("is-danger")),h.each((function(){e(this).find(v).parent().toggle(v.children().length>0),e(this).find(g).parent().toggle(g.children().length>0)}))}),1)})),f.length>0||w.length>0){var i=window.location.pathname.split("reviews/")[0]+"reviews/",a='<a href="'+i+'" class="sentiment-graph-back pseudo-link js-sentiment-back-on-page" role="button"><span class="sentiment-graph-back-arrow"><svg><use xlink:href="#arrow"></use></svg></span>Все сущности</a>',l='<a href="'+i+'" class="sentiment-graph-navigation-item pseudo-link js-sentiment-back-on-page" role="button">Все сущности</a>';e(".js-sentiment-back.sentiment-graph-back").after(a),e(".js-sentiment-back.sentiment-graph-navigation-item").after(l),e(".js-sentiment-back").remove()}setTimeout(A,50),setTimeout(I,50)}),1)},drillup:function(){setTimeout((function(){L.update({chart:{zoomType:""}}),n.hide(),r.removeClass("is-success is-danger").html("Все сущности"),m.html(""),y.tagId=0,E(),e(L.series).each((function(t,s){var i="",a=s.data[0].link;f.length>0&&(a=a.split("reviews/")[0]+"reviews/"+s.data[0].tag+"/"),i=w.length>0||f.length>0?e.parseHTML('<a href="'+a+'" class="sentiment-graph-item js-sentiment-item sentiment-link" data-series="'+t+'">'+s.data[0].name+" <span>("+s.zData[0]+")</span></a>"):e.parseHTML('<button class="sentiment-graph-item js-sentiment-item 1" data-series="'+t+'" data-tag="'+s.data[0].tag+'">'+s.data[0].name+" <span>("+s.zData[0]+")</span></button>"),e(".js-review-gap").unwrap().remove(),setTimeout((function(){T.highlight(s.data[0].name,t,"is-highlight js-review-highlight "+s.data[0].drilldown,"js-review-gap"),s.yData[0]>=0?(e(i).appendTo(v),e(x+'[data-series="'+t+'"]').addClass("is-success")):(e(i).appendTo(g),e(x+'[data-series="'+t+'"]').addClass("is-danger")),h.each((function(){e(this).find(v).parent().toggle(0!=v.children().length),e(this).find(g).parent().toggle(0!=g.children().length)}))}),1);var n=e(".highcharts-data-label-color-"+t);n.attr("href",a),n.addClass("sentiment-link")})),setTimeout(A,50),setTimeout(I,50),S=e(".highcharts-series")}),1)}}},title:{text:null},tooltip:{enabled:!1},legend:{enabled:!1},xAxis:{title:{enabled:!1},startOnTick:!0,endOnTick:!0,gridLineWidth:1,gridLineColor:"#e2e2e2",gridLineDashStyle:"ShortDash",tickColor:"#e2e2e2",tickLength:15,tickPixelInterval:100,showLastLabel:!1,labels:{y:30,style:{color:"#777777",fontSize:"10px"}}},yAxis:{title:{enabled:!1},gridLineWidth:1,gridLineColor:"#e2e2e2",plotLines:[{color:"#9c9c9c",width:1,value:0,zIndex:2}],labels:{enabled:!1}},plotOptions:{bubble:{minSize:5,maxSize:"11%",zMin:0,zMax:null,animation:{duration:500}},series:{stickyTracking:!1,zoneAxis:"y",zones:[{value:0,className:"zone-no"},{className:"zone-yes"}],states:{inactive:{opacity:1}},marker:{fillOpacity:1,lineWidth:2,states:{hover:{enabled:!1}}},dataLabels:{enabled:!0,useHTML:!0,formatter:function(){return t.outerWidth()<=1099?'<span style="position:relative;bottom:-'+(this.point.marker.radius+10)+'px;">'+this.point.name+"</span>":'<span style="position:relative;bottom:-'+(this.point.marker.radius+15)+'px;">'+this.point.name+"</span>"},style:{fontSize:"8px",color:"#000000",textOutline:"none"}},events:{mouseOver:function(){setTimeout((function(){if(void 0!==L.drillUpButton)return!1;e(L.series).each((function(t,s){e(p+'[data-series="'+t+'"]').toggleClass("is-hover",e(".highcharts-series-"+t+".highcharts-series-hover").length>0),e(".highcharts-series-"+t+".highcharts-series-hover").length>0?(e(x).addClass("is-disable"),e(x+'[data-series="'+t+'"]').removeClass("is-disable")):e(x+'[data-series="'+t+'"]').addClass("is-disable")}))}),1)},mouseOut:function(){setTimeout((function(){if(void 0!==L.drillUpButton)return!1;e(p).removeClass("is-hover"),e(x).removeClass("is-disable")}),1)}}}},series:[],drilldown:{activeDataLabelStyle:{color:"#000000",textDecoration:"none"},activeAxisLabelStyle:{color:"#777777",textDecoration:"none"},drillUpButton:{theme:{display:"none"}},series:[]},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{chart:{height:250},xAxis:{tickPixelInterval:50},yAxis:{tickPixelInterval:30}}}]}});function A(){t.outerWidth()>=1100&&h.each((function(){e(this).find(m).outerHeight()>54?(e(this).css("max-height",54),e(this).find(".js-sentiment-full").css("display","flex")):(e(this).css("max-height",""),e(this).find(".js-sentiment-full").css("display","none"))}))}function I(){var t=e(".js-review-text");e(".js-review-expand");t.parent().parent().each((function(){var t=e(this),s=t.outerHeight(),i=t.find(".review-item-scroll").outerHeight();t.parent().toggleClass("is-scroll",i>s),e(this).parents(".modal.is-open").length&&t.on("scroll",(function(){t.parent().toggleClass("is-scroll",Math.ceil(i-t.scrollTop())!=Math.ceil(s))}))}))}function D(t){var s=e(".js-review-slideNav .swiper-wrapper"),i=e(".js-review-slideFor .swiper-wrapper");s.html(""),i.html(""),e(t).each((function(t,a){var n="",r="";a.tags.success.length>0&&(n=' <div class="review-item-tag-wrap">\n<div class="review-item-tag-label">Позитивно:</div>\n<div class="review-item-tag-row">',e(a.tags.success).each((function(e,t){n+='<a class="review-item-tag-link is-success" href="/">'+t+"</a>"})),n+="</div>\n</div>"),a.tags.danger.length>0&&(r=' <div class="review-item-tag-wrap">\n<div class="review-item-tag-label">Негативно:</div>\n<div class="review-item-tag-row">',e(a.tags.danger).each((function(e,t){r+='<a class="review-item-tag-link is-danger" href="/">'+t+"</a>"})),r+="</div>\n</div>");var l=e.parseHTML(' <div class="swiper-slide">\n                                <a class="review-item-toggle js-modal-show" href="#review-modal"></a>\n                                <div class="review-item">\n                                    <div class="review-item-head">\n                                        <div class="review-item-logo">\n                                            <img src="'+y.logo.SRC+'" alt="'+y.logo.ALT+'"/>\n                                        </div>\n                                        <div class="review-item-user">\n                                            <div class="review-item-user-emoji">\n                                               <img src="'+("is-success"==a.classAppend?"/local/templates/main/img/emoji/emoji-smiling.png":"/local/templates/main/img/emoji/emoji-pouting.png")+'" alt=""/>\n                                            </div>\n                                            <div class="review-item-user-info">\n                                                <div class="review-item-user-name">'+a.author+'\n                                                </div>\n                                                <div class="review-item-user-date">'+a.date+'\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="review-item-status '+("is-success"==a.classAppend?"is-success":"is-danger")+'">\n                                            <div class="review-item-status-label">\n                                               '+("is-success"==a.classAppend?"Позитивный отзыв":"Негативный отзыв")+'\n                                            </div>\n                                            <div class="review-item-status-check">проверен\n                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10">\n                                                    <path d="M11.69.26h0a1.09,1.09,0,0,1,.06,1.45L4.93,10,.29,5a1.09,1.09,0,0,1,0-1.46h0A.86.86,0,0,1,1.5,3.45l.07.07L4.85,7.06,10.4.31A.87.87,0,0,1,11.62.2Z"></path>\n                                                </svg>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="review-item-body js-modal-scroll">\n                                        <div class="review-item-scroll">\n                                            <div class="review-item-tag">\n'+(n||" ")+"\n"+(r||" ")+'\n                                            </div>\n                                            <div class="review-item-text js-review-text">'+a.text+'\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="review-item-foot">\n'+(a.source.name?'<div class="review-item-source">Источник: '+a.source.name+"</div>":" ")+'\n                                        <button class="review-item-expand js-review-expand">Развернуть</button>\n                                    </div>\n                                </div>\n                            </div>');e(l).clone().appendTo(s),e(l).clone().appendTo(i)})),k.get(0).swiper.update(),k.get(0).swiper.slideTo(0),C.get(0).swiper.init(),C.get(0).swiper.update(),C.get(0).swiper.slideTo(0),setTimeout(A,50),setTimeout(I,50)}function N(t){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s&&j.html(""),e(t).each((function(t,s){e(e.parseHTML(' <div class="swiper-slide">\n                                <a class="review-item-toggle js-modal-show" href="#review-modal"></a>\n                                <div class="review-item">\n                                    <div class="review-item-head">\n                                        <div class="review-item-logo">\n                                            <img src="'+y.logo.SRC+'" alt="'+y.logo.ALT+'"/>\n                                        </div>\n                                        <div class="review-item-user">\n                                            <div class="review-item-user-emoji">\n                                               <img src="'+("is-success"==s.classAppend?"/local/templates/main/img/emoji/emoji-smiling.png":"/local/templates/main/img/emoji/emoji-pouting.png")+'" alt=""/>\n                                            </div>\n                                            <div class="review-item-user-info">\n                                                <div class="review-item-user-name">'+s.author+'\n                                                </div>\n                                                <div class="review-item-user-date">'+s.date+'\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="review-item-status '+("is-success"==s.classAppend?"is-success":"is-danger")+'">\n                                            <div class="review-item-status-label">\n                                               '+("is-success"==s.classAppend?"Позитивный отзыв":"Негативный отзыв")+'\n                                            </div>\n                                            <div class="review-item-status-check">проверен\n                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10">\n                                                    <path d="M11.69.26h0a1.09,1.09,0,0,1,.06,1.45L4.93,10,.29,5a1.09,1.09,0,0,1,0-1.46h0A.86.86,0,0,1,1.5,3.45l.07.07L4.85,7.06,10.4.31A.87.87,0,0,1,11.62.2Z"></path>\n                                                </svg>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="review-item-body js-modal-scroll">\n                                        <div class="review-item-scroll">\n                                            <div class="review-item-tag">\n'+(positiveTags||" ")+"\n"+(negativeTags||" ")+'\n                                            </div>\n                                            <div class="review-item-text js-review-text">'+s.text+'\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="review-item-foot">\n'+(s.source.name?'<div class="review-item-source">Источник: '+s.source.name+"</div>":" ")+'\n                                        <button class="review-item-expand js-review-expand">Развернуть</button>\n                                    </div>\n                                </div>\n                            </div>')).appendTo(j)})),setTimeout(A,50),setTimeout(I,50)}function z(t){var s=e(t);if(u.length>0){var i=s.is(".js-pagination-sentiment")?s.filter(".js-pagination-sentiment"):s.find(".js-pagination-sentiment");u.empty().append(i.children())}else j.after(t)}function E(t){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i={action:"load-comments",bookmaker:y.bookmakerId,tag:y.tagId,count:y.count,slider:y.slider,subTag:y.subTag,paginationTemplate:y.paginationTemplate};t&&t>1&&(i.page="page-"+t),e.get(y.ajaxPath,i,(function(e){y.slider?D(e.comments):N(e.comments,s),y.paginationTemplate&&z(e.pagination)}),"json")}function M(t){var s=e(".js-meta-sentiments"),i=s.attr("data-title"),a=s.attr("data-desc"),n=document.location.pathname;t>1&&(i=s.attr("data-nav-title-template")+t,a=s.attr("data-nav-desc-template")+t,n+="?page=page-"+t),history.pushState("","",n),document.title=i,e(document).find("meta[name=description]").attr("content",a)}L.update(y.series,!0,!0),L.options.drilldown=a.a.merge(L.options.drilldown,{series:y.drilldown.series}),v.empty(),g.empty(),e(L.series).each((function(t,s){var i="",a=s.data[0].link;if(f.length>0&&(a=a.split("reviews/")[0]+"reviews/"+s.data[0].tag+"/"),w.length<=0){var n=a.split("/");a="/"+n[1]+"/"+n[2]+"/reviews/"+s.data[0].tag+"/"}i=w.length>0?e.parseHTML('<a href="'+a+'" class="sentiment-graph-item js-sentiment-item sentiment-link" data-series="'+t+'">'+s.data[0].name+" <span>("+s.zData[0]+")</span></a>"):e.parseHTML('<button class="sentiment-graph-item js-sentiment-item" data-series="'+t+'" data-tag="'+s.data[0].tag+'">'+s.data[0].name+" <span>("+s.zData[0]+")</span></button>"),T.highlight(s.data[0].name,t,"is-highlight js-review-highlight "+s.data[0].drilldown,"js-review-gap"),s.yData[0]>=0?(e(i).appendTo(v),e(x+'[data-series="'+t+'"]').addClass("is-success")):(e(i).appendTo(g),e(x+'[data-series="'+t+'"]').addClass("is-danger")),A(),h.each((function(){e(this).find(v).parent().toggle(v.children().length>0),e(this).find(g).parent().toggle(g.children().length>0)}));var r=e(".highcharts-data-label-color-"+t);r.attr("href",a),r.addClass("sentiment-link")})),i.addClass("is-loaded");var S=e(".highcharts-series"),H=".highcharts-point",O=".highcharts-label";if(s.on("mousedown",".highcharts-data-label",(function(){(w.length>0||f.length>0)&&e(this).hasClass("sentiment-link")&&(U(e(this)),W(e(this).text()))})),s.on("click",p,(function(t){t.preventDefault();var s=e(this).data("series"),i=e(this).data("id");if(e(this).hasClass("sentiment-link")&&(U(e(this)),W(e(this).text())),void 0!==L.drillUpButton)return e(p).removeClass("is-focus"),e(this).addClass("is-focus"),y.tagId=i,E(),!1;L.series[s].data[0].doDrilldown()})),s.on("mouseover mouseout",p,(function(){var t=e(this).data("series");void 0===L.drillUpButton?(S.toggleClass("highcharts-series-inactive"),e(".highcharts-series-"+t).removeClass("highcharts-series-inactive"),e(x).toggleClass("is-disable"),e(x+'[data-series="'+t+'"]').removeClass("is-disable")):(e(H).toggleClass("is-disable"),e(H).eq(t).removeClass("highcharts-point-hover is-disable"),e(x).toggleClass("is-disable"),e(x+'[data-series="'+t+'"]').removeClass("is-disable"))})),s.on("click",O,(function(){if(void 0===L.drillUpButton)return!1;e(L.series[0].data).each((function(t,s){e(H).eq(t).hasClass("highcharts-point-hover")&&e(p+'[data-series="'+t+'"]').trigger("click")}))})),s.on("mouseover",O,(function(){if(void 0===L.drillUpButton)return!1;e(this).addClass("highcharts-label-hover");var t=e(".highcharts-label-hover").index();e(H).eq(t).addClass("highcharts-point-hover"),e(L.series[0].data).each((function(t,s){var i=e(H).eq(t).hasClass("highcharts-point-hover");e(p+'[data-series="'+t+'"]').toggleClass("is-hover",i),i&&(e(H).addClass("is-disable"),e(".highcharts-point.highcharts-point-hover").removeClass("is-disable"),e(x).addClass("is-disable"),e(x+'[data-series="'+t+'"]').removeClass("is-disable"))}))})),s.on("mouseout",O,(function(){if(void 0===L.drillUpButton)return!1;e(p).removeClass("is-hover"),e(H).removeClass("highcharts-point-hover is-disable"),e(O).removeClass("highcharts-label-hover"),e(x).removeClass("is-disable")})),u.length>0&&(u.on("click","a",(function(t){t.preventDefault();var s=e(document.body).add(document.documentElement),i=parseInt(e(this).attr("data-page"));!isNaN(i)&&i>0&&!e(this).parent().hasClass(".is-active")&&(s.animate({scrollTop:j.offset().top-15},200),E(i)),M(i)})),s.on("click",".js-more-sentiment",(function(t){t.preventDefault();var s=e(document.body).add(document.documentElement),i=parseInt(e(this).attr("data-page"));!isNaN(i)&&i>0&&(s.animate({scrollTop:j.offset().top-15},200),E(i)),M(i)})),s.on("click",".js-more-sentiment-ajax",(function(t){t.preventDefault();var s=parseInt(e(this).attr("data-page"));!isNaN(s)&&s>0&&E(s,!1)}))),s.on("click",".js-sentiment-back-on-page",(function(t){(w.length>0||f.length>0)&&(t.preventDefault(),U(e(this)),W(),e(".highcharts-drillup-button").trigger("click"))})),s.on("click",".js-sentiment-back",(function(){e(".highcharts-drillup-button").trigger("click")})),s.on("click",".js-sentiment-full",(function(){var t=e(this).siblings().outerHeight();e(this).fadeOut(300),e(this).parent().css("max-height",t+10)})),f.length>0){var B=window.location.pathname.split("/reviews/")[1].replace("/","");e('.js-sentiment-item["data-tag='+B+'"]').trigger("click")}function U(e){var t=e.attr("href");history.pushState("","",t)}function W(t){var s=b.data("settings"),i=s.DEFAULT.H1,a=s.DEFAULT.DESCRIPTION,n=s.DEFAULT.TITLE;if(t){var r=t.replace(/\(.+\)/,"");i=s.NEW.H1.replace("#SENTIMENT#",r),a=s.NEW.DESCRIPTION.replace("#SENTIMENT#",r),n=s.NEW.TITLE.replace("#SENTIMENT#",r)}document.title=n,document.querySelector('meta[name="description"]').setAttribute("content",a),e(".workarea-title h1").text(i)}}s("../../node_modules/highcharts/highcharts-more.js")(a.a),s("../../node_modules/highcharts/modules/drilldown.js")(a.a)}.call(this,s("../../node_modules/clean_jquery/dist/jquery.js"))}}]);