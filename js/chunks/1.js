(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"../blocks/sentiment/sentiment.js":function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"init",(function(){return n}));var s=i("../../node_modules/highcharts/highcharts.js"),a=i.n(s);function n(){e.fn.highlight=function(t,i,s,a){var n=new RegExp(t,"i");return this.each((function(){e(this).contents().filter((function(){return 3==this.nodeType&&n.test(this.nodeValue)})).replaceWith((function(){return(this.nodeValue||"").replace(n,(function(e){return'<span class="'+s+'" data-series="'+i+'"><span class="'+a+'"></span>'+e+"</span>"}))}))}))};var t=e(window),i=e(document),s=e(".js-sentiment-load"),n=e(".js-sentiment-tool"),r=e(".js-sentiment-title"),l=e(".js-sentiment-indicator"),o=e(".js-sentiment-bg"),d=e(".js-sentiment-bg-success"),h=e(".js-sentiment-bg-danger"),c=e(".js-sentiment-list"),m=e(".js-sentiment-scroll"),g=e(".is-success.js-sentiment-scroll"),p=e(".is-danger.js-sentiment-scroll"),v=".js-sentiment-item",u=e(".js-pagination-sentiment"),f=e(".sentiment-review-page"),w=e(".sentiment-detail-page"),b=e(".js-sentiment-meta"),j=e(".js-review-list"),k=e(".js-review-body"),x=e(".js-review-text"),T=".js-review-full",y=".js-review-highlight",C=e(".js-review-slideNav"),L=e(".js-review-slideFor");n.clone().appendTo(".sentiment-graph-body"),n=e(".js-sentiment-tool");var I=e(".sentiment-graph").data("settings");I=e.extend({},{drilldown:[],series:[],ajaxPath:"",bookmakerId:0,tagId:0,slider:!1,count:10,paginationTemplate:""},I);var D=a.a.chart("js-sentiment",{chart:{type:"bubble",plotBorderWidth:1,plotBorderColor:"#e2e2e2",style:{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif","z-index":"1"},zoomType:"",margin:[1,1,null,1],events:{render:function(){setTimeout((function(){var t=e(".highcharts-plot-background").height();l.height(t+2),o.height(t+2)}),500);var t=Math.abs(this.yAxis[0].min),i=Math.abs(this.yAxis[0].max);this.yAxis[0].min>0&&this.yAxis[0].max>0?t=0:this.yAxis[0].min<0&&this.yAxis[0].max<0&&(i=0);var s=t+i,a=100*t/s,n=100*i/s;a<n||a>n?(l.css({background:"linear-gradient(to top, #d0021b "+a+"%, #20a94a "+a+"%)"}),d.css("height",n+"%"),h.css("height",a+"%")):(l.css({background:"linear-gradient(to top, #d0021b 50%, #20a94a 50%)"}),d.css("height",n+"%"),h.css("height",a+"%"))},drilldown:function(){setTimeout((function(){var t=D.series[0].chart.drilldownLevels[0].pointOptions.y,i=D.drilldownLevels[0].pointOptions.name;if(D.update({chart:{zoomType:""}}),n.css("display","flex"),t>=0?r.addClass("is-success"):r.addClass("is-danger"),r.html("Упоминания под тегом "+i),m.html(""),I.tagId=D.drilldownLevels[0].pointOptions.id,S(),e(D.series[0].data).each((function(t,i){var s=e.parseHTML('<button class="sentiment-graph-item sentiment-sub-tag js-sentiment-item" data-series="'+t+'" data-id="'+i.dataId+'">'+i.name+" <span>("+i.z+")</span></button>");e(".js-review-gap").unwrap().remove(),setTimeout((function(){x.highlight(i.name,t,"is-highlight js-review-highlight "+i.class,"js-review-gap"),i.y>=0?(e(s).appendTo(g),e(y+'[data-series="'+t+'"]').addClass("is-success")):(e(s).appendTo(p),e(y+'[data-series="'+t+'"]').addClass("is-danger")),c.each((function(){e(this).find(g).parent().toggle(g.children().length>0),e(this).find(p).parent().toggle(p.children().length>0)}))}),1)})),w.length>0||f.length>0){var s=window.location.pathname.split("reviews/")[0]+"reviews/",a='<a href="'+s+'" class="sentiment-graph-back pseudo-link js-sentiment-back-on-page" role="button"><span class="sentiment-graph-back-arrow"><svg><use xlink:href="#arrow"></use></svg></span>Все сущности</a>',l='<a href="'+s+'" class="sentiment-graph-navigation-item pseudo-link js-sentiment-back-on-page" role="button">Все сущности</a>';e(".js-sentiment-back.sentiment-graph-back").after(a),e(".js-sentiment-back.sentiment-graph-navigation-item").after(l),e(".js-sentiment-back").remove()}setTimeout((function(){N()}),1)}),1)},drillup:function(){setTimeout((function(){D.update({chart:{zoomType:""}}),n.hide(),r.removeClass("is-success is-danger").html("Все сущности"),m.html(""),I.tagId=0,S(),e(D.series).each((function(t,i){var s="",a=i.data[0].link;w.length>0&&(a=a.split("reviews/")[0]+"reviews/"+i.data[0].tag+"/"),s=f.length>0||w.length>0?e.parseHTML('<a href="'+a+'" class="sentiment-graph-item js-sentiment-item sentiment-link" data-series="'+t+'">'+i.data[0].name+" <span>("+i.zData[0]+")</span></a>"):e.parseHTML('<button class="sentiment-graph-item js-sentiment-item 1" data-series="'+t+'" data-tag="'+i.data[0].tag+'">'+i.data[0].name+" <span>("+i.zData[0]+")</span></button>"),e(".js-review-gap").unwrap().remove(),setTimeout((function(){x.highlight(i.data[0].name,t,"is-highlight js-review-highlight "+i.data[0].drilldown,"js-review-gap"),i.yData[0]>=0?(e(s).appendTo(g),e(y+'[data-series="'+t+'"]').addClass("is-success")):(e(s).appendTo(p),e(y+'[data-series="'+t+'"]').addClass("is-danger")),c.each((function(){e(this).find(g).parent().toggle(0!=g.children().length),e(this).find(p).parent().toggle(0!=p.children().length)}))}),1);var n=e(".highcharts-data-label-color-"+t);n.attr("href",a),n.addClass("sentiment-link")})),setTimeout((function(){N()}),1),M=e(".highcharts-series")}),1)}}},title:{text:null},tooltip:{enabled:!1},legend:{enabled:!1},xAxis:{title:{enabled:!1},startOnTick:!0,endOnTick:!0,gridLineWidth:1,gridLineColor:"#e2e2e2",gridLineDashStyle:"ShortDash",tickColor:"#e2e2e2",tickLength:15,tickPixelInterval:100,showLastLabel:!1,labels:{y:30,style:{color:"#777777",fontSize:"10px"}}},yAxis:{title:{enabled:!1},gridLineWidth:1,gridLineColor:"#e2e2e2",plotLines:[{color:"#9c9c9c",width:1,value:0,zIndex:2}],labels:{enabled:!1}},plotOptions:{bubble:{minSize:5,maxSize:"11%",zMin:0,zMax:null,animation:{duration:500}},series:{stickyTracking:!1,zoneAxis:"y",zones:[{value:0,className:"zone-no"},{className:"zone-yes"}],states:{inactive:{opacity:1}},marker:{fillOpacity:1,lineWidth:2,states:{hover:{enabled:!1}}},dataLabels:{enabled:!0,useHTML:!0,formatter:function(){return t.outerWidth()<=1099?'<span style="position:relative;bottom:-'+(this.point.marker.radius+10)+'px;">'+this.point.name+"</span>":'<span style="position:relative;bottom:-'+(this.point.marker.radius+15)+'px;">'+this.point.name+"</span>"},style:{fontSize:"8px",color:"#000000",textOutline:"none"}},events:{mouseOver:function(){setTimeout((function(){if(void 0!==D.drillUpButton)return!1;e(D.series).each((function(t,i){e(v+'[data-series="'+t+'"]').toggleClass("is-hover",e(".highcharts-series-"+t+".highcharts-series-hover").length>0),e(".highcharts-series-"+t+".highcharts-series-hover").length>0?(e(y).addClass("is-disable"),e(y+'[data-series="'+t+'"]').removeClass("is-disable")):e(y+'[data-series="'+t+'"]').addClass("is-disable")}))}),1)},mouseOut:function(){setTimeout((function(){if(void 0!==D.drillUpButton)return!1;e(v).removeClass("is-hover"),e(y).removeClass("is-disable")}),1)}}}},series:[],drilldown:{activeDataLabelStyle:{color:"#000000",textDecoration:"none"},activeAxisLabelStyle:{color:"#777777",textDecoration:"none"},drillUpButton:{theme:{display:"none"}},series:[]},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{chart:{height:250},xAxis:{tickPixelInterval:50},yAxis:{tickPixelInterval:30}}}]}});function N(){t.outerWidth()>=1100&&c.each((function(){e(this).find(m).outerHeight()>54?(e(this).css("max-height",54),e(this).find(".js-sentiment-full").css("display","flex")):(e(this).css("max-height",""),e(this).find(".js-sentiment-full").css("display","none"))})),k.each((function(){e(this).find(x).outerHeight()>102?(e(this).css("max-height",102),e(this).find(T).css("display","flex")):(e(this).css("max-height",""),e(this).find(T).css("display","none"))}))}function z(t){var i=e(".js-review-slideNav .swiper-wrapper"),s=e(".js-review-slideFor .swiper-wrapper");i.html(""),s.html(""),e(t).each((function(t,a){var n=e.parseHTML('<div class="swiper-slide">\n<a class="review-item-toggle js-modal-show" href="#review"></a>\n<div class="review-item">\n<div class="review-item-head">\n<div class="review-item-user">\n<div class="review-item-img">\n<img src="/local/templates/main/img/icons/user.svg" alt="User" />\n</div>\n<div class="review-item-info">\n<div class="review-item-name">'+a.author+"</div>\n"+(a.source.name?'<span class="review-item-link">'+a.source.name+"</span>":" ")+'\n</div>\n</div>\n<div class="review-item-date">'+a.date+'</div>\n</div>\n<div class="review-item-body js-review-body js-modal-scroll">\n<div class="review-item-text js-review-text">'+a.text+'</div>\n<div class="review-item-full js-review-full">еще</div>\n</div>\n</div>\n</div>');e(n).clone().appendTo(i),e(n).clone().appendTo(s)})),C.get(0).swiper.update(),C.get(0).swiper.slideTo(0),L.get(0).swiper.update(),L.get(0).swiper.slideTo(0),k=e(".js-review-body"),x=e(".js-review-text"),T=".js-review-full",modalTarget=document.querySelectorAll(".js-modal-scroll"),N()}function E(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&j.html(""),e(t).each((function(t,i){e(e.parseHTML(' <div class="sentiment-review-item">\n<div class="sentiment-review-item-head">\n<div class="sentiment-review-item-user">\n<div class="sentiment-review-item-img">\n<img src="/local/templates/main/img/icons/user.svg" alt="User" />\n</div>\n<div class="sentiment-review-item-info">\n<div class="sentiment-review-item-name">'+i.author+"</div>\n"+(i.source.name?'<span class="sentiment-review-item-link">'+i.source.name+"</span>":" ")+'\n</div>\n</div>\n<div class="sentiment-review-item-date">'+i.date+'</div>\n</div>\n<div class="sentiment-review-item-body js-review-body">\n<div class="sentiment-review-item-text js-review-text">'+i.text+'</div>\n<div class="sentiment-review-item-full js-review-full">еще</div>\n</div>\n</div>')).appendTo(j)})),k=e(".js-review-body"),x=e(".js-review-text"),T=".js-review-full",N()}function A(t){var i=e(t);if(u.length>0){var s=i.is(".js-pagination-sentiment")?i.filter(".js-pagination-sentiment"):i.find(".js-pagination-sentiment");u.empty().append(s.children())}else j.after(t)}function S(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s={action:"load-comments",bookmaker:I.bookmakerId,tag:I.tagId,count:I.count,slider:I.slider,subTag:I.subTag,paginationTemplate:I.paginationTemplate};t&&t>1&&(s.page="page-"+t),e.get(I.ajaxPath,s,(function(e){I.slider?z(e.comments):E(e.comments,i),I.paginationTemplate&&A(e.pagination)}),"json")}function H(t){var i=e(".js-meta-sentiments"),s=i.attr("data-title"),a=i.attr("data-desc"),n=document.location.pathname;t>1&&(s=i.attr("data-nav-title-template")+t,a=i.attr("data-nav-desc-template")+t,n+="?page=page-"+t),history.pushState("","",n),document.title=s,e(document).find("meta[name=description]").attr("content",a)}D.update(I.series,!0,!0),D.options.drilldown=a.a.merge(D.options.drilldown,{series:I.drilldown.series}),g.empty(),p.empty(),e(D.series).each((function(t,i){var s="",a=i.data[0].link;w.length>0&&(a=a.split("reviews/")[0]+"reviews/"+i.data[0].tag+"/"),s=f.length>0?e.parseHTML('<a href="'+a+'" class="sentiment-graph-item js-sentiment-item sentiment-link" data-series="'+t+'">'+i.data[0].name+" <span>("+i.zData[0]+")</span></a>"):e.parseHTML('<button class="sentiment-graph-item js-sentiment-item" data-series="'+t+'" data-tag="'+i.data[0].tag+'">'+i.data[0].name+" <span>("+i.zData[0]+")</span></button>"),x.highlight(i.data[0].name,t,"is-highlight js-review-highlight "+i.data[0].drilldown,"js-review-gap"),i.yData[0]>=0?(e(s).appendTo(g),e(y+'[data-series="'+t+'"]').addClass("is-success")):(e(s).appendTo(p),e(y+'[data-series="'+t+'"]').addClass("is-danger")),N(),c.each((function(){e(this).find(g).parent().toggle(g.children().length>0),e(this).find(p).parent().toggle(p.children().length>0)}));var n=e(".highcharts-data-label-color-"+t);n.attr("href",a),n.addClass("sentiment-link")})),s.addClass("is-load");var M=e(".highcharts-series"),O=".highcharts-point",U=".highcharts-label";if(i.on("mousedown",".highcharts-data-label",(function(){e(this).hasClass("sentiment-link")&&(B(e(this)),q(e(this).text()))})),i.on("click",v,(function(t){t.preventDefault();var i=e(this).data("series"),s=e(this).data("id");if(e(this).hasClass("sentiment-link")&&(B(e(this)),q(e(this).text())),void 0!==D.drillUpButton)return e(v).removeClass("is-focus"),e(this).addClass("is-focus"),I.tagId=s,S(),!1;D.series[i].data[0].doDrilldown()})),i.on("mouseover mouseout",v,(function(){var t=e(this).data("series");void 0===D.drillUpButton?(M.toggleClass("highcharts-series-inactive"),e(".highcharts-series-"+t).removeClass("highcharts-series-inactive"),e(y).toggleClass("is-disable"),e(y+'[data-series="'+t+'"]').removeClass("is-disable")):(e(O).toggleClass("is-disable"),e(O).eq(t).removeClass("highcharts-point-hover is-disable"),e(y).toggleClass("is-disable"),e(y+'[data-series="'+t+'"]').removeClass("is-disable"))})),i.on("click",U,(function(){if(void 0===D.drillUpButton)return!1;e(D.series[0].data).each((function(t,i){e(O).eq(t).hasClass("highcharts-point-hover")&&e(v+'[data-series="'+t+'"]').trigger("click")}))})),i.on("mouseover",U,(function(){if(void 0===D.drillUpButton)return!1;e(this).addClass("highcharts-label-hover");var t=e(".highcharts-label-hover").index();e(O).eq(t).addClass("highcharts-point-hover"),e(D.series[0].data).each((function(t,i){var s=e(O).eq(t).hasClass("highcharts-point-hover");e(v+'[data-series="'+t+'"]').toggleClass("is-hover",s),s&&(e(O).addClass("is-disable"),e(".highcharts-point.highcharts-point-hover").removeClass("is-disable"),e(y).addClass("is-disable"),e(y+'[data-series="'+t+'"]').removeClass("is-disable"))}))})),i.on("mouseout",U,(function(){if(void 0===D.drillUpButton)return!1;e(v).removeClass("is-hover"),e(O).removeClass("highcharts-point-hover is-disable"),e(U).removeClass("highcharts-label-hover"),e(y).removeClass("is-disable")})),u.length>0&&(u.on("click","a",(function(t){t.preventDefault();var i=e(document.body).add(document.documentElement),s=parseInt(e(this).attr("data-page"));!isNaN(s)&&s>0&&!e(this).parent().hasClass(".is-active")&&(i.animate({scrollTop:j.offset().top-15},200),S(s)),H(s)})),i.on("click",".js-more-sentiment",(function(t){t.preventDefault();var i=e(document.body).add(document.documentElement),s=parseInt(e(this).attr("data-page"));!isNaN(s)&&s>0&&(i.animate({scrollTop:j.offset().top-15},200),S(s)),H(s)})),i.on("click",".js-more-sentiment-ajax",(function(t){t.preventDefault();var i=parseInt(e(this).attr("data-page"));!isNaN(i)&&i>0&&S(i,!1)}))),i.on("click",".js-sentiment-back-on-page",(function(t){(f.length>0||w.length>0)&&(t.preventDefault(),B(e(this)),q(),e(".highcharts-drillup-button").trigger("click"))})),i.on("click",".js-sentiment-back",(function(){e(".highcharts-drillup-button").trigger("click")})),i.on("click",".js-sentiment-full",(function(){var t=e(this).siblings().outerHeight();e(this).fadeOut(300),e(this).parent().css("max-height",t+10)})),w.length>0){var W=window.location.pathname.split("/reviews/")[1].replace("/","");e('.js-sentiment-item["data-tag='+W+'"]').trigger("click")}function B(e){var t=e.attr("href");history.pushState("","",t)}function q(t){var i=b.data("settings"),s=i.DEFAULT.H1,a=i.DEFAULT.DESCRIPTION,n=i.DEFAULT.TITLE;if(t){var r=t.replace(/\(.+\)/,"");s=i.NEW.H1.replace("#SENTIMENT#",r),a=i.NEW.DESCRIPTION.replace("#SENTIMENT#",r),n=i.NEW.TITLE.replace("#SENTIMENT#",r)}document.title=n,document.querySelector('meta[name="description"]').setAttribute("content",a),e(".workarea-title h1").text(s)}}i("../../node_modules/highcharts/highcharts-more.js")(a.a),i("../../node_modules/highcharts/modules/drilldown.js")(a.a)}.call(this,i("../../node_modules/clean_jquery/dist/jquery.js"))}}]);